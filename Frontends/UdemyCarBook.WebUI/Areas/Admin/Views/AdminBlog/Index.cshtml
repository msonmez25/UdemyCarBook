@model List<ResultAllBlogsWithAuthorsDto>
@{
    ViewData["Title"] = "Blog Listesi";
    Layout = "~/Views/AdminLayout/Index.cshtml";
}

<style>
    /* Minimal ve Profesyonel Stil */
    .page-header-card {
        background: white;
        border-radius: 15px;
        padding: 20px 25px;
        margin-bottom: 25px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        border-left: 5px solid #667eea;
    }

    /* BÜYÜK BADGE STİLLERİ */
    .stats-badge {
        display: inline-block;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        text-align: center;
        min-width: 140px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        margin: 0 8px;
    }

        .stats-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

    .stats-badge-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .stats-badge-success {
        background: linear-gradient(135deg, #42e695 0%, #3bb2b8 100%);
        color: white;
    }

    .stats-badge-warning {
        background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        color: #7d4e00;
    }

    .stats-badge-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
        color: white;
    }

    .badge-icon {
        font-size: 1.2rem;
        margin-right: 8px;
        vertical-align: middle;
    }

    .badge-text {
        display: block;
        font-size: 0.85rem;
        opacity: 0.9;
        margin-bottom: 4px;
    }

    .badge-number {
        display: block;
        font-size: 1.6rem;
        font-weight: 700;
    }

    .table-container {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 30px rgba(0,0,0,0.08);
    }

    /* DataTable Stilleri */
    #blogsTable_wrapper {
        padding: 0 !important;
    }

    #blogsTable {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 0 !important;
    }

        #blogsTable thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }

            #blogsTable thead th {
                color: white !important;
                font-weight: 600 !important;
                padding: 16px 12px !important;
                border: none !important;
                font-size: 0.9rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
                position: relative !important;
            }

        #blogsTable tbody tr {
            transition: all 0.3s ease !important;
            border-bottom: 1px solid #f1f3fa !important;
        }

            #blogsTable tbody tr:hover {
                background-color: #f8f9fe !important;
                transform: translateX(5px) !important;
            }

        #blogsTable tbody td {
            padding: 16px 12px !important;
            vertical-align: middle !important;
            border: none !important;
            color: #495057 !important;
            font-weight: 500 !important;
            font-size: 0.9rem !important;
        }

    /* BLOG VE YAZAR BİLGİLERİ */
    .blog-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-width: 200px;
    }

    .blog-title-row {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .blog-icon-small {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }

    .blog-content {
        flex: 1;
        min-width: 0;
    }

    .blog-title {
        font-weight: 700;
        color: #374151;
        font-size: 0.95rem;
        line-height: 1.3;
        margin-bottom: 2px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .author-row {
        display: flex;
        align-items: center;
        gap: 8px;
        padding-left: 48px;
    }

    .author-icon-small {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        flex-shrink: 0;
    }

    .author-name {
        font-size: 0.8rem;
        color: #6c757d;
        font-weight: 500;
    }

    /* KATEGORİ BADGE */
    .category-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-align: center;
        min-width: 80px;
        background: linear-gradient(135deg, #42e695 0%, #3bb2b8 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(66, 230, 149, 0.3);
    }

    /* TARİH GÖSTERİMİ */
    .date-container {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 120px;
    }

    .date-icon-small {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        margin-bottom: 5px;
    }

    .date-label {
        font-weight: 600;
        font-size: 0.75rem;
        color: #6c757d;
        margin-bottom: 2px;
    }

    .date-value {
        font-weight: 600;
        color: #374151;
        font-size: 0.85rem;
    }

    /* İşlem Butonları */
    .action-buttons {
        display: flex;
        gap: 6px;
        justify-content: center;
    }

    .btn-action {
        width: 34px;
        height: 34px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border: none;
        color: white;
        cursor: pointer;
    }

    .btn-danger-action {
        background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
    }

        .btn-danger-action:hover {
            background: linear-gradient(135deg, #ff5252 0%, #ff8e8e 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

    .btn-warning-action {
        background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        color: #7d4e00;
    }

        .btn-warning-action:hover {
            background: linear-gradient(135deg, #f4c852 0%, #fc9270 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(246, 211, 101, 0.3);
        }

    .btn-secondary-action {
        background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%);
        color: white;
    }

        .btn-secondary-action:hover {
            background: linear-gradient(135deg, #96b2ff 0%, #372587 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 192, 255, 0.3);
        }

    /* Sıra Numarası */
    .row-number {
        display: inline-block;
        width: 28px;
        height: 28px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 28px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .stats-badge {
            padding: 10px 15px;
            min-width: 120px;
            margin: 5px;
            display: block;
            width: calc(100% - 20px);
        }

        .badge-number {
            font-size: 1.4rem;
        }

        .blog-title-row, .author-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 6px;
        }

        .author-row {
            padding-left: 0;
        }

        .blog-icon-small, .author-icon-small {
            width: 32px;
            height: 32px;
        }
    }

    /* DataTable Custom Stilleri */
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter,
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_processing,
    .dataTables_wrapper .dataTables_paginate {
        padding: 16px !important;
        color: #495057 !important;
        font-size: 0.85rem !important;
    }

        .dataTables_wrapper .dataTables_filter input {
            border-radius: 8px !important;
            border: 1px solid #e3e6f0 !important;
            padding: 8px 16px !important;
            width: 220px !important;
            transition: all 0.3s ease !important;
        }

            .dataTables_wrapper .dataTables_filter input:focus {
                border-color: #667eea !important;
                box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
                outline: none !important;
            }

        .dataTables_wrapper .dataTables_length select {
            border-radius: 8px !important;
            border: 1px solid #e3e6f0 !important;
            padding: 6px 10px !important;
            background: white !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            border-radius: 8px !important;
            margin: 0 4px !important;
            border: 1px solid #e3e6f0 !important;
            padding: 6px 10px !important;
            transition: all 0.3s ease !important;
            background: white !important;
            color: #495057 !important;
            font-size: 0.85rem !important;
        }

            .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
                border-color: #667eea !important;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button.current {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
                border-color: #667eea !important;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
                opacity: 0.5 !important;
                cursor: not-allowed !important;
            }

    /* Admin Notu */
    .admin-note {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        border: 1px solid #ffeaa7;
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        color: #856404;
        font-size: 0.9rem;
        line-height: 1.5;
    }

        .admin-note i {
            color: #ffc107;
            margin-right: 10px;
            font-size: 1.1rem;
        }
</style>

<div class="page-content">
    <div class="container-fluid">

        <!-- Başlık Kartı -->
        <div class="page-header-card">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h4 class="mb-1" style="color: #374151; font-weight: 700; font-size: 1.4rem;">
                        <i class="fas fa-blog mr-2" style="color: #667eea;"></i>
                        Blog Listesi
                    </h4>
                    <p class="text-muted mb-0" style="font-size: 0.9rem;">Sistemdeki tüm blog yazıları</p>
                </div>
                <div class="col-md-6">
                    <div class="text-md-right">
                        <!-- KOMPAKT STATS BADGELER -->
                        <div class="d-flex justify-content-end flex-wrap">
                            <div class="stats-badge stats-badge-primary">
                                <span class="badge-text">
                                    <i class="fas fa-newspaper badge-icon"></i>Toplam Blog
                                </span>
                                <span class="badge-number">@Model.Count</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Notu -->
        <div class="admin-note">
            <i class="fas fa-info-circle"></i>
            <strong>Yönetici Notu:</strong> Bloglar ile ilgili görüntüleme, silme ve güncelleme aşağıdan düzenleyebilirsiniz. Yeni blog ekleme işlemi admin tarafından yapılmamaktadır. Blog eklemek isterseniz sisteme yazar olarak giriş yapmanız gerekmektedir. Her yazar sadece kendi bloglarını düzenleyebilir. Bunun için uygulamada Login/WriterLogin sayfası üzerinden giriş yapabilirsiniz.
        </div>

        <!-- Tablo Container -->
        <div class="table-container">
            <div class="p-3">
                <div class="table-responsive">
                    <!-- DataTable başlatıcı ID -->
                    <table id="blogsTable" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th width="50">#</th>
                                <th width="280">Blog Bİlgİlerİ</th>
                                <th width="120">Kategorİ</th>
                                <th width="120">Tarİh</th>
                                <th width="120" class="text-center">İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        <span class="row-number">0</span> <!-- DataTable otomatik dolduracak -->
                                    </td>
                                    <td>
                                        <div class="blog-info">
                                            <div class="blog-title-row">
                                                <div class="blog-icon-small">
                                                    <i class="fas fa-file-alt"></i>
                                                </div>
                                                <div class="blog-content">
                                                    <div class="blog-title">@item.Title</div>
                                                </div>
                                            </div>
                                            <div class="author-row">
                                                <div class="author-icon-small">
                                                    @item.AuthorName.Substring(0, 1)
                                                </div>
                                                <div class="author-name">@item.AuthorName</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="category-badge">@item.CategoryName</span>
                                    </td>
                                    <td>
                                        <div class="date-container">
                                            <div class="date-icon-small">
                                                <i class="fas fa-calendar-alt"></i>
                                            </div>
                                            <div>
                                                <div class="date-label">OLUŞTURULDU</div>
                                                <div class="date-value">@(((DateTime)item.CreatedDate).ToString("dd.MM.yyyy"))</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="action-buttons">
                                            <a href="/Admin/AdminBlog/RemoveBlog/@item.BlogID"
                                               class="btn-action btn-danger-action"
                                               title="Yayından Kaldır"
                                               onclick="return confirm('@item.Title başlıklı blogu yayından kaldırmak istediğinize emin misiniz?')">
                                                <i class="fas fa-trash-alt"></i>
                                            </a>
                                            <a href="/Blog/BlogDetail/@item.BlogID" target="_blank"
                                               class="btn-action btn-warning-action"
                                               title="Blogu Gör">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="/Admin/AdminComment/CommentListByBLogId/@item.BlogID"
                                               class="btn-action btn-secondary-action"
                                               title="Yorumları Gör">
                                                <i class="fas fa-comments"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Font Awesome ikonları -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- DataTables Scripts -->
<script src="~/Admin/vertical/assets/js/jquery.min.js"></script>
<script src="~/Admin/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="~/Admin/plugins/datatables/dataTables.bootstrap4.js"></script>
<script src="~/Admin/plugins/datatables/dataTables.responsive.min.js"></script>
<script src="~/Admin/plugins/datatables/responsive.bootstrap4.min.js"></script>
<script src="~/Admin/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="~/Admin/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="~/Admin/plugins/datatables/buttons.html5.min.js"></script>
<script src="~/Admin/plugins/datatables/buttons.flash.min.js"></script>
<script src="~/Admin/plugins/datatables/buttons.print.min.js"></script>
<script src="~/Admin/plugins/datatables/dataTables.keyTable.min.js"></script>
<script src="~/Admin/plugins/datatables/dataTables.select.min.js"></script>
<script src="~/Admin/plugins/datatables/pdfmake.min.js"></script>
<script src="~/Admin/plugins/datatables/vfs_fonts.js"></script>

<script>
    $(document).ready(function() {
        // DataTable Initialization
        var table = $('#blogsTable').DataTable({
            "language": {
                "url": "https://cdn.datatables.net/plug-ins/1.10.20/i18n/Turkish.json",
                "decimal": ",",
                "thousands": ".",
                "sEmptyTable": "Tabloda herhangi bir veri mevcut değil",
                "sInfo": "_TOTAL_ kayıttan _START_ - _END_ arasındaki kayıtlar gösteriliyor",
                "sInfoEmpty": "Kayıt yok",
                "sInfoFiltered": "(_MAX_ kayıt içerisinden bulunan)",
                "sInfoPostFix": "",
                "sInfoThousands": ".",
                "sLengthMenu": "Sayfada _MENU_ kayıt göster",
                "sLoadingRecords": "Yükleniyor...",
                "sProcessing": "İşleniyor...",
                "sSearch": "<i class='fas fa-search mr-2'></i>Ara:",
                "sZeroRecords": "Eşleşen kayıt bulunamadı",
                "oPaginate": {
                    "sFirst": "İlk",
                    "sLast": "Son",
                    "sNext": "Sonraki",
                    "sPrevious": "Önceki"
                },
                "oAria": {
                    "sSortAscending": ": artan sırada sırala",
                    "sSortDescending": ": azalan sırada sırala"
                }
            },
            "dom": "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                   "<'row'<'col-sm-12'tr>>" +
                   "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            "pageLength": 10,
            "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]],
            "order": [[3, 'desc']], // Tarihe göre ters sırala (en yeni en üstte)
            "responsive": true,
            "autoWidth": false,
            "columnDefs": [
                {
                    "orderable": false,
                    "targets": [4] // İşlemler sütunu sıralanmasın
                },
                {
                    "searchable": false,
                    "targets": [0, 4] // Sıra no ve işlemler sütunu aranmasın
                },
                {
                    "className": "text-center",
                    "targets": [0, 2, 3, 4] // Sıra no, kategori, tarih ve işlemleri ortala
                },
                {
                    "width": "50px",
                    "targets": [0]
                },
                {
                    "width": "280px",
                    "targets": [1]
                },
                {
                    "width": "120px",
                    "targets": [2, 3, 4]
                }
            ],
            "initComplete": function(settings, json) {
                // Tablo hazır olduğunda row number'ları güncelle
                updateRowNumbers(this);
            },
            "drawCallback": function(settings) {
                // Her sayfa değiştiğinde row number'ları güncelle
                updateRowNumbers(this.api());
            }
        });

        // Row number güncelleme fonksiyonu
        function updateRowNumbers(dataTable) {
            var api = dataTable;
            var pageInfo = api.page.info();

            api.rows({ page: 'current' }).every(function(rowIdx, tableLoop, rowLoop) {
                var cell = this.cell(rowIdx, 0).node();
                var rowNumber = (pageInfo.page * pageInfo.length) + (rowLoop + 1);
                $(cell).html('<span class="row-number">' + rowNumber + '</span>');
            });
        }

        // Silme onayı
        $(document).on('click', '.btn-danger-action', function(e) {
            var blogTitle = $(this).closest('tr').find('.blog-title').text().trim();
            if (!confirm(blogTitle + ' başlıklı blogu yayından kaldırmak istediğinize emin misiniz?\n\nBu işlem geri alınamaz!')) {
                e.preventDefault();
                return false;
            }
        });

        // Stats badge'e tıklanınca filtreleme
        $('.stats-badge').click(function() {
            table.search('').draw();

            // Tıklanan badge'i vurgula
            $('.stats-badge').css({
                'transform': 'translateY(0)',
                'box-shadow': '0 4px 15px rgba(0,0,0,0.1)'
            });
            $(this).css({
                'transform': 'translateY(-3px)',
                'box-shadow': '0 8px 25px rgba(0,0,0,0.2)'
            });
        });

        // Blog başlığına tıklayınca detay göster
        $(document).on('click', '.blog-title', function() {
            var fullTitle = $(this).text();
            alert('Blog Başlığı: ' + fullTitle);
        });

        // Sayfa yüklendiğinde DataTable'ı yeniden boyutlandır
        $(window).on('resize', function() {
            table.columns.adjust().responsive.recalc();
        });

        // Tablo hazır olduğunda bir kereliğine row number'ları güncelle
        setTimeout(function() {
            updateRowNumbers(table);
        }, 100);
    });
</script>